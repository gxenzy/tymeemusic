<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tymee Music Dashboard</title>
    <link rel="stylesheet" href="styles.css" />
    <script>
        // Immediate auth check on page load - just set localStorage if auth works
        (async function () {
            console.log("=== INLINE AUTH CHECK ===");
            try {
                const response = await fetch("/auth/check");
                const data = await response.json();
                if (data.authenticated && data.user) {
                    console.log("Inline: Auth succeeded for user:", data.user.username);
                    localStorage.setItem("dashboard_user", JSON.stringify(data.user));
                    localStorage.setItem("dashboard_auth", "true");
                } else {
                    console.log("Inline: Auth failed, keeping existing localStorage");
                    // Don't clear localStorage here - let MusicDashboard handle it
                }
            } catch (e) {
                console.error("Inline auth check failed:", e);
                // Don't clear localStorage on network error
            }
        })();
    </script>
    <!-- Socket.IO client (served automatically by the Socket.IO server at /socket.io/socket.io.js) -->
    <script src="/socket.io/socket.io.js"></script>
</head>

<body>
    <!-- Initial App Loader -->
    <div id="appLoader" class="app-loader">
        <div class="loader-content">
            <div class="music-spinner">
                <div class="bar bar1"></div>
                <div class="bar bar2"></div>
                <div class="bar bar3"></div>
                <div class="bar bar4"></div>
            </div>
            <h2>TymeeMusic</h2>
            <p>Loading your dashboard...</p>
        </div>
    </div>

    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1>üéµ Tymee Music Dashboard</h1>
                <!-- Theme controls (local only; saved in your browser) -->
                <!-- Theme controls moved to User Dropdown -->
                <div class="auth-section" id="authSection">
                    <button id="loginBtn" class="login-btn" onclick="
                this.disabled = true;
                this.textContent = 'Logging in...';
                window.location.href = '/auth/discord';
              ">
                        Login with Discord
                    </button>
                </div>
                <div class="user-section hidden" id="userSection">
                    <div class="user-dropdown-container" id="userDropdownContainer">
                        <div class="user-trigger" id="userDropdownTrigger">
                            <img id="userAvatar" class="user-avatar" src="" alt="User Avatar" />
                            <span id="userName" class="user-name"></span>
                            <span class="dropdown-arrow">‚ñº</span>
                        </div>
                        <div class="user-dropdown-menu hidden" id="userDropdownMenu">
                            <div class="user-menu-header">
                                Signed in as <strong id="userDropdownName">User</strong>
                            </div>
                            <div class="theme-picker-section">
                                <h4>Theme</h4>
                                <div class="theme-grid">
                                    <div class="theme-swatch default" data-theme="default" title="Default"></div>
                                    <div class="theme-swatch peach" data-theme="peach" title="Peach"></div>
                                    <div class="theme-swatch nebula" data-theme="nebula" title="Nebula"></div>
                                    <div class="theme-swatch ocean" data-theme="ocean" title="Ocean"></div>
                                    <div class="theme-swatch synthwave" data-theme="synthwave" title="Synthwave"></div>
                                    <div class="theme-swatch aurora" data-theme="aurora" title="Aurora"></div>
                                    <div class="theme-swatch emerald" data-theme="emerald" title="Emerald"></div>
                                    <div class="theme-swatch midnight" data-theme="midnight" title="Midnight"></div>
                                    <div class="theme-swatch sunset" data-theme="sunset" title="Sunset"></div>
                                    <div class="theme-swatch rose" data-theme="rose" title="Rose"></div>
                                </div>
                            </div>
                            <div class="menu-divider"></div>
                            <button id="logoutBtn" class="menu-item danger">Sign Out</button>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <!-- Server Selector -->
        <div id="serverSelector" class="server-selector hidden">
            <h3>Select a Server</h3>
            <div id="serverList" class="server-list"></div>
        </div>
        <nav id="navBar" class="nav-bar hidden">
            <button class="nav-btn" data-page="player">üéµ Player</button>
            <button class="nav-btn" data-page="queue">üìã Queue</button>
            <button class="nav-btn" data-page="radio">üìª Radio</button>
            <button class="nav-btn" data-page="playlists">üìù Playlists</button>
            <button class="nav-btn" data-page="emojis">üé® Emojis</button>
            <button class="nav-btn" data-page="settings">‚öôÔ∏è Settings</button>
            <button class="nav-btn" data-page="stats">üìä Stats</button>
        </nav>
        <!-- Connection Status -->
        <div id="connectionStatus" class="status-bar hidden">
            <span id="statusText">Disconnected</span>
        </div>
        <!-- Main Content -->
        <main id="mainContent" class="main-content">
            <!-- Homepage (MiTone Style) -->
            <div id="homePage" class="page">
                <section class="hero">
                    <div class="hero-content">
                        <h1 class="hero-title">Experience Music Like <span class="text-gradient">Never Before</span>
                        </h1>
                        <p class="hero-subtitle">The most advanced Discord music bot with a premium web dashboard,
                            custom animated
                            emojis, and crystal clear audio.</p>
                        <div class="hero-btns">
                            <button class="cta-btn primary"
                                onclick="window.open('https://discord.com/api/oauth2/authorize?client_id=1140026214515327006&permissions=8&scope=bot%20applications.commands')">Add
                                to Discord</button>
                            <button class="cta-btn secondary" onclick="dashboard.showPage('player')">Open
                                Dashboard</button>
                        </div>
                    </div>
                </section>
                <section class="stats-grid">
                    <div class="stat-card">
                        <h3 id="stat-servers">0+</h3>
                        <p>Servers</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="stat-users">0+</h3>
                        <p>Users</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="stat-tracks">0+</h3>
                        <p>Tracks Played</p>
                    </div>
                </section>
                <section class="features">
                    <h2 class="section-title">Why Choose <span class="text-gradient">TymeeMusic</span>?</h2>
                    <div class="features-grid">
                        <div class="feature-card">
                            <div class="feature-icon">‚ú®</div>
                            <h3>Animated Progress Bars</h3>
                            <p>Exclusive custom GIF emojis for a truly unique music player experience.</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">üîä</div>
                            <h3>Lossless Audio</h3>
                            <p>High-fidelity audio streaming with support for Spotify, YouTube, and more.</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">üéõÔ∏è</div>
                            <h3>Advanced Filters</h3>
                            <p>Apply 8D, Bass Boost, Nightcore, and many other filters with one click.</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">üåê</div>
                            <h3>Rich Dashboard</h3>
                            <p>Control your music, manage playlists, and sync emojis in real-time from the web.</p>
                        </div>
                    </div>
                </section>
            </div>
            <!-- Login Required Message -->
            <div id="loginRequired" class="login-required">
                <h2>üîê Login Required</h2>
                <p>Please login with Discord to access the dashboard.</p>
                <button id="loginRequiredBtn" class="login-btn" onclick="
              this.disabled = true;
              this.textContent = 'Logging in...';
              window.location.href = '/auth/discord';
            ">
                    Login with Discord
                </button>
            </div>
            <!-- Error Display -->
            <div id="errorDisplay" class="login-required hidden" style="background: #ed4245; color: white">
                <h2>‚ùå Error</h2>
                <p id="errorMessage">An error occurred</p>
            </div>
            <!-- Player Page -->
            <div id="playerPage" class="page hidden">
                <div class="player-section">
                    <div class="now-playing">
                        <div class="album-art">
                            <img id="albumArt" src="" alt="Album Art" class="album-image hidden" />
                            <div id="noArtwork" class="no-artwork">‚ô™</div>
                        </div>
                        <div class="track-info">
                            <h2 id="trackTitle" class="track-title">No track playing</h2>
                            <p id="trackArtist" class="track-artist">Unknown Artist</p>
                            <p id="guildName" class="guild-name"></p>
                        </div>
                    </div>
                    <!-- Progress Bar -->
                    <div class="progress-section">
                        <div class="progress-bar-container">
                            <div id="progressBar" class="progress-bar">
                                <div id="progressFill" class="progress-fill"></div>
                            </div>
                        </div>
                        <div class="time-display">
                            <span id="currentTime">0:00</span>
                            <span id="totalTime">0:00</span>
                        </div>
                    </div>
                    <!-- Controls -->
                    <div class="controls">
                        <button id="shuffleBtn" class="control-btn" title="Shuffle">
                            üîÄ
                        </button>
                        <button id="previousBtn" class="control-btn" title="Previous">
                            ‚èÆÔ∏è
                        </button>
                        <button id="playPauseBtn" class="control-btn play-pause" title="Play/Pause">
                            ‚ñ∂Ô∏è
                        </button>
                        <button id="nextBtn" class="control-btn" title="Next">‚è≠Ô∏è</button>
                        <button id="repeatBtn" class="control-btn" title="Repeat">
                            üîÅ
                        </button>
                    </div>
                    <!-- Volume Control -->
                    <div class="volume-section">
                        <span id="volumeIcon">üîä</span>
                        <input type="range" id="volumeSlider" min="0" max="100" value="100" class="volume-slider" />
                        <span id="volumeValue" class="volume-value">100%</span>
                    </div>
                    <!-- Utility Controls (Premium) -->
                    <div class="utility-controls">
                        <div class="sleep-timer-container">
                            <button id="sleepTimerBtn" class="utility-btn" title="Sleep Timer"
                                onclick="dashboard.toggleSleepMenu()">
                                üí§ <span id="sleepTimerStatus">Off</span>
                            </button>
                            <div id="sleepTimerMenu" class="dropdown-menu hidden">
                                <div class="dropdown-item" onclick="dashboard.setSleepTimer(0)">Cancel</div>
                                <div class="dropdown-item" onclick="dashboard.setSleepTimer(5)">5 Minutes</div>
                                <div class="dropdown-item" onclick="dashboard.setSleepTimer(15)">15 Minutes</div>
                                <div class="dropdown-item" onclick="dashboard.setSleepTimer(30)">30 Minutes</div>
                                <div class="dropdown-item" onclick="dashboard.setSleepTimer(60)">1 Hour</div>
                            </div>
                        </div>
                        <button id="lyricsBtn" class="utility-btn" title="View Lyrics" onclick="dashboard.showLyrics()">
                            üìù Lyrics
                        </button>
                        <button id="addToPlaylistBtn" class="utility-btn" title="Add to Playlist"
                            onclick="dashboard.openAddToPlaylistModal()">
                            ‚ûï Add
                        </button>
                    </div>
                </div>
            </div>
            <!-- Queue Page -->
            <div id="queuePage" class="page hidden">
                <div class="queue-section">
                    <div class="queue-header">
                        <h3>Queue (<span id="queueCount">0</span>)</h3>
                        <div class="queue-actions">
                            <button id="shuffleQueueBtn" class="action-btn" title="Shuffle">
                                üîÄ Shuffle
                            </button>
                            <button id="clearQueueBtn" class="action-btn danger" title="Clear">
                                üóëÔ∏è Clear
                            </button>
                        </div>
                    </div>
                    <div id="queueList" class="queue-list">
                        <p class="empty-queue">No tracks in queue</p>
                    </div>
                </div>
            </div>
            <!-- Radio Page -->
            <div id="radioPage" class="page hidden">
                <div class="radio-section">
                    <div class="section-header">
                        <h3>üìª Radio Stations</h3>
                        <p>Select a themed station to start an endless music stream</p>
                    </div>
                    <div class="radio-grid">
                        <div class="radio-card" onclick="dashboard.startRadio('lofi')">
                            <div class="radio-icon">‚òï</div>
                            <div class="radio-info">
                                <h4>Lofi / Chill</h4>
                                <p>Perfect for study and relaxation</p>
                            </div>
                        </div>
                        <div class="radio-card" onclick="dashboard.startRadio('rock')">
                            <div class="radio-icon">üé∏</div>
                            <div class="radio-info">
                                <h4>Rock Classic</h4>
                                <p>The greatest rock hits of all time</p>
                            </div>
                        </div>
                        <div class="radio-card" onclick="dashboard.startRadio('pop')">
                            <div class="radio-icon">üíÉ</div>
                            <div class="radio-info">
                                <h4>Pop Hits</h4>
                                <p>Today's top charts and dance tracks</p>
                            </div>
                        </div>
                        <div class="radio-card" onclick="dashboard.startRadio('edm')">
                            <div class="radio-icon">üéß</div>
                            <div class="radio-info">
                                <h4>Electronic / EDM</h4>
                                <p>Upbeat beats and dance floor energy</p>
                            </div>
                        </div>
                        <div class="radio-card" onclick="dashboard.startRadio('jazz')">
                            <div class="radio-icon">üéπ</div>
                            <div class="radio-info">
                                <h4>Jazz / Study</h4>
                                <p>Smooth jazz and coffee shop vibes</p>
                            </div>
                        </div>
                        <div class="radio-card" onclick="dashboard.startRadio('hiphop')">
                            <div class="radio-icon">üî•</div>
                            <div class="radio-info">
                                <h4>Hip Hop</h4>
                                <p>Golden era and modern hip hop bangers</p>
                            </div>
                        </div>
                        <div class="radio-card" onclick="dashboard.startRadio('gaming')">
                            <div class="radio-icon">üéÆ</div>
                            <div class="radio-info">
                                <h4>Gaming / Phonk</h4>
                                <p>High energy tracks for your gaming session</p>
                            </div>
                        </div>
                        <div class="radio-card" onclick="dashboard.startRadio('kpop')">
                            <div class="radio-icon">üåà</div>
                            <div class="radio-info">
                                <h4>K-Pop</h4>
                                <p>The best of Korean pop music</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Playlists Page -->
            <div id="playlistsPage" class="page hidden">
                <div class="playlists-section">
                    <div class="playlists-header">
                        <button id="backToPlaylistsBtn" class="action-btn secondary hidden"
                            onclick="dashboard.showPlaylistsList()">
                            ‚Üê Back
                        </button>
                        <h3 id="playlistsPageTitle">My Playlists</h3>
                        <div class="playlists-actions">
                            <button id="refreshPlaylistsBtn" class="action-btn" onclick="dashboard.loadPlaylists()">
                                üîÑ
                            </button>
                            <button id="createPlaylistBtn" class="action-btn primary">
                                ‚ûï Create Playlist
                            </button>
                        </div>
                    </div>
                    <!-- Unified Create/Import Playlist Modal -->
                    <div id="createPlaylistModal" class="modal hidden">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4>Manage Playlists</h4>
                                <button class="modal-close"
                                    onclick="dashboard.closeModal('createPlaylistModal')">&times;</button>
                            </div>
                            <div class="modal-body">
                                <div class="modal-tabs">
                                    <button class="modal-tab active" data-tab="create"
                                        onclick="dashboard.switchPlaylistTab('create')">Create New</button>
                                    <button class="modal-tab" data-tab="import"
                                        onclick="dashboard.switchPlaylistTab('import')">Import</button>
                                </div>

                                <!-- Create Tab -->
                                <div id="playlist-tab-create" class="playlist-tab-content">
                                    <div class="form-group">
                                        <label>Playlist Name</label>
                                        <input type="text" id="newPlaylistName" placeholder="My Awesome Playlist"
                                            class="setting-input" />
                                    </div>
                                    <div class="form-group">
                                        <label>Description (optional)</label>
                                        <textarea id="newPlaylistDescription" placeholder="What's this playlist about?"
                                            class="setting-input"></textarea>
                                    </div>
                                    <div class="form-group checkbox-group">
                                        <label class="toggle-label">
                                            <span class="toggle-text">Make Public</span>
                                            <div class="toggle-switch">
                                                <input type="checkbox" id="newPlaylistPublic" />
                                                <span class="toggle-slider"></span>
                                            </div>
                                        </label>
                                        <span class="setting-help">Public playlists are visible to everyone in the
                                            server</span>
                                    </div>
                                </div>

                                <!-- Import Tab -->
                                <div id="playlist-tab-import" class="playlist-tab-content hidden">
                                    <div class="form-group">
                                        <label>Playlist URL</label>
                                        <input type="text" id="importPlaylistUrl"
                                            placeholder="Spotify or YouTube playlist URL" class="setting-input" />
                                        <span class="setting-help">Supported: Spotify Playlists, YouTube
                                            Playlists</span>
                                    </div>
                                    <div class="import-info">
                                        <p>‚ÑπÔ∏è Tracks will be searched on YouTube and added to a new playlist.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button onclick="dashboard.closeModal('createPlaylistModal')"
                                    class="action-btn secondary">Cancel</button>
                                <button id="createPlaylistConfirmBtn" onclick="dashboard.handlePlaylistSubmit()"
                                    class="action-btn primary">Create Playlist</button>
                            </div>
                        </div>
                    </div>
                    <!-- Add to Playlist Modal -->
                    <div id="addToPlaylistModal" class="modal hidden">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4>Add to Playlist</h4>
                                <button class="modal-close"
                                    onclick="dashboard.closeModal('addToPlaylistModal')">&times;</button>
                            </div>
                            <div class="modal-body">
                                <p class="modal-subtitle">Select a playlist to add this track to:</p>
                                <div id="addToPlaylistList" class="add-to-playlist-list">
                                    <!-- Populated by JS -->
                                    <div class="loader-spinner"></div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button onclick="dashboard.closeModal('addToPlaylistModal')"
                                    class="action-btn secondary">Cancel</button>
                                <button
                                    onclick="dashboard.openCreatePlaylistModal(); dashboard.closeModal('addToPlaylistModal')"
                                    class="action-btn">Create New Playlist</button>
                            </div>
                        </div>
                    </div>
                    <!-- Playlist Details View -->
                    <div id="playlistDetailsView" class="hidden">
                        <div class="playlist-header">
                            <div id="playlistCover" class="playlist-cover">
                                <span class="playlist-cover-placeholder">‚ô™</span>
                            </div>
                            <div class="playlist-header-info">
                                <p class="playlist-type">Playlist</p>
                                <h1 id="playlistTitle" class="playlist-title">
                                    Playlist Name
                                </h1>
                                <p id="playlistDescription" class="playlist-description"></p>
                                <div class="playlist-meta">
                                    <span id="playlistCreator" class="playlist-creator"></span>
                                    <span class="meta-dot">‚Ä¢</span>
                                    <span id="playlistTrackCount"></span>
                                    <span class="meta-dot">‚Ä¢</span>
                                    <span id="playlistDuration"></span>
                                </div>
                            </div>
                        </div>
                        <div class="playlist-controls">
                            <button id="playlistPlayBtn" class="playlist-play-btn" onclick="dashboard.playPlaylist()">
                                ‚ñ∂
                            </button>
                            <button id="playlistShuffleBtn" class="playlist-control-btn"
                                onclick="dashboard.shufflePlaylist()" title="Shuffle">
                                üîÄ
                            </button>
                            <button id="playlistMoreBtn" class="playlist-control-btn"
                                onclick="dashboard.showPlaylistMoreOptions()" title="More options">
                                ‚ãÆ
                            </button>
                        </div>
                        <!-- Search & Add Tracks -->
                        <div class="playlist-search-section">
                            <input type="text" id="playlistSearchInput" class="playlist-search-input"
                                placeholder="Search for songs to add..." onkeypress="
                    if (event.key === 'Enter')
                      dashboard.searchTracksForPlaylist();
                  " />
                            <select id="playlistSearchSource" class="playlist-search-source">
                                <option value="all">All Sources</option>
                                <option value="youtube">YouTube</option>
                                <option value="spotify">Spotify</option>
                                <option value="soundcloud">SoundCloud</option>
                                <option value="apple">Apple Music</option>
                                <option value="deezer">Deezer</option>
                            </select>
                            <button class="action-btn primary" onclick="dashboard.searchTracksForPlaylist()">
                                üîç Search
                            </button>
                        </div>
                        <!-- Search Results -->
                        <div id="playlistSearchResults" class="playlist-search-results hidden"></div>
                        <div class="playlist-tracks-header">
                            <div class="track-col-num">#</div>
                            <div class="track-col-title">Title</div>
                            <div class="track-col-album">Album</div>
                            <div class="track-col-duration">üïí</div>
                            <div class="track-col-actions"></div>
                        </div>
                        <div id="playlistTracksList" class="playlist-tracks-list"></div>
                    </div>
                    <!-- Playlists Grid View -->
                    <div id="playlistsList" class="playlists-list">
                        <p class="empty-playlists">
                            No playlists found. Create your first playlist!
                        </p>
                    </div>
                </div>
            </div>
            <!-- Settings Page -->
            <div id="settingsPage" class="page hidden">
                <div class="settings-section">
                    <h3>‚öôÔ∏è Server Settings</h3>
                    <div class="settings-tabs">
                        <button class="settings-tab active" data-tab="general">
                            General
                        </button>
                        <button class="settings-tab" data-tab="djroles">DJ Roles</button>
                        <button class="settings-tab" data-tab="permissions">
                            Permissions
                        </button>
                        <button class="settings-tab" data-tab="247">24/7 Mode</button>
                        <button class="settings-tab" data-tab="premium">Premium</button>
                    </div>
                    <!-- General Settings -->
                    <div id="settings-general" class="settings-tab-content">
                        <div class="settings-group">
                            <label>Command Prefix</label>
                            <input type="text" id="prefixInput" class="setting-input" placeholder="." maxlength="5" />
                            <span class="setting-help">The character used before commands (e.g., .play)</span>
                        </div>
                        <div class="settings-group">
                            <label>Default Volume:
                                <span id="defaultVolumeValue">100%</span></label>
                            <input type="range" id="defaultVolumeSlider" min="0" max="100" value="100"
                                class="setting-slider" />
                        </div>
                        <div class="settings-group checkbox-group">
                            <label class="toggle-label" onclick="
                    return dashboard.handleToggleClick(event, 'autoPlayCheck');
                  ">
                                <span class="toggle-text">Auto-play</span>
                                <div class="toggle-switch">
                                    <span class="toggle-slider"></span>
                                </div>
                                <input type="checkbox" id="autoPlayCheck" style="display: none" />
                            </label>
                            <span class="setting-help">Automatically play similar songs when queue ends</span>
                        </div>
                        <div class="settings-group checkbox-group">
                            <label class="toggle-label" onclick="
                    return dashboard.handleToggleClick(
                      event,
                      'leaveOnEmptyCheck',
                    );
                  ">
                                <span class="toggle-text">Leave on Empty</span>
                                <div class="toggle-switch">
                                    <span class="toggle-slider"></span>
                                </div>
                                <input type="checkbox" id="leaveOnEmptyCheck" style="display: none" />
                            </label>
                            <span class="setting-help">Bot leaves voice channel when queue is empty</span>
                        </div>
                    </div>
                    <!-- DJ Roles Settings (Multi-Select) -->
                    <div id="settings-djroles" class="settings-tab-content hidden">
                        <div class="settings-group">
                            <label>DJ Roles</label>
                            <p class="setting-description">
                                Users with any of these roles will have DJ privileges
                            </p>
                            <div class="role-multi-select">
                                <div class="role-tags" id="djRolesTags"></div>
                                <select id="djRolesSelect" class="setting-select" onchange="dashboard.addDjRole()">
                                    <option value="">Select a role to add...</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <!-- Permissions Settings (Tier System) -->
                    <div id="settings-permissions" class="settings-tab-content hidden">
                        <div class="settings-group">
                            <label>Access Tier</label>
                            <p class="setting-description">
                                Choose which tier of commands users can access based on their
                                roles or direct user assignment
                            </p>
                            <div class="tier-selector">
                                <!-- Free Tier -->
                                <div class="tier-option">
                                    <label class="tier-option-label">
                                        <input type="radio" name="tier" value="free"
                                            onchange="dashboard.updateTierDisplay()" />
                                        <span class="tier-name">üéµ Free</span>
                                        <span class="tier-desc">Basic commands only</span>
                                    </label>
                                    <div class="tier-roles">
                                        <label class="sub-label">Roles:</label>
                                        <div class="role-tags" id="allowedRolesTags"></div>
                                        <select id="allowedRolesSelect" class="setting-select"
                                            onchange="dashboard.addAllowedRole()">
                                            <option value="">Select a role...</option>
                                        </select>
                                        <label class="sub-label">Users:</label>
                                        <div class="user-tags" id="allowedUsersTags"></div>
                                        <select id="allowedUsersSelect" class="setting-select"
                                            onchange="dashboard.addAllowedUser()">
                                            <option value="">Select a user...</option>
                                        </select>
                                    </div>
                                </div>
                                <!-- VIP Tier -->
                                <div class="tier-option">
                                    <label class="tier-option-label">
                                        <input type="radio" name="tier" value="vip"
                                            onchange="dashboard.updateTierDisplay()" />
                                        <span class="tier-name">‚≠ê VIP</span>
                                        <span class="tier-desc">Extended features</span>
                                    </label>
                                    <div class="tier-roles">
                                        <label class="sub-label">Roles:</label>
                                        <div class="role-tags" id="vipRolesTags"></div>
                                        <select id="vipRolesSelect" class="setting-select"
                                            onchange="dashboard.addVipRole()">
                                            <option value="">Select a role...</option>
                                        </select>
                                        <label class="sub-label">Users:</label>
                                        <div class="user-tags" id="vipUsersTags"></div>
                                        <select id="vipUsersSelect" class="setting-select"
                                            onchange="dashboard.addVipUser()">
                                            <option value="">Select a user...</option>
                                        </select>
                                    </div>
                                </div>
                                <!-- Premium Tier -->
                                <div class="tier-option">
                                    <label class="tier-option-label">
                                        <input type="radio" name="tier" value="premium"
                                            onchange="dashboard.updateTierDisplay()" />
                                        <span class="tier-name">üíé Premium</span>
                                        <span class="tier-desc">All features</span>
                                    </label>
                                    <div class="tier-roles">
                                        <label class="sub-label">Roles:</label>
                                        <div class="role-tags" id="premiumRolesTags"></div>
                                        <select id="premiumRolesSelect" class="setting-select"
                                            onchange="dashboard.addPremiumRole()">
                                            <option value="">Select a role...</option>
                                        </select>
                                        <label class="sub-label">Users:</label>
                                        <div class="user-tags" id="premiumUsersTags"></div>
                                        <select id="premiumUsersSelect" class="setting-select"
                                            onchange="dashboard.addPremiumUser()">
                                            <option value="">Select a user...</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 24/7 Mode Settings -->
                    <div id="settings-247" class="settings-tab-content hidden">
                        <div class="settings-group">
                            <label class="big-toggle" onclick="dashboard.handleToggleClick(event, 'stay247Check')">
                                <div>
                                    <span class="toggle-text-main">Enable 24/7 Mode</span>
                                    <span class="toggle-text-sub">The bot will stay in the voice channel even when not
                                        playing.</span>
                                </div>
                                <div class="toggle-switch large">
                                    <span class="toggle-slider"></span>
                                </div>
                                <input type="checkbox" id="stay247Check" onchange="dashboard.toggle247Channels()"
                                    style="display: none" />
                            </label>
                        </div>

                        <div id="247ChannelsSection" class="hidden">
                            <div class="settings-group">
                                <label>Target Voice Channel</label>
                                <select id="247VoiceChannelSelect" class="setting-select">
                                    <option value="">None</option>
                                </select>
                            </div>
                            <div class="settings-group">
                                <label>Status Updates Channel</label>
                                <select id="247TextChannelSelect" class="setting-select">
                                    <option value="">None</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <!-- Premium Settings -->
                    <div id="settings-premium" class="settings-tab-content hidden">
                        <div class="premium-banner">
                            <div class="premium-icon">üíé</div>
                            <div class="premium-text">
                                <h3>Upgrade to Premium</h3>
                                <p>Unlock 24/7 mode, higher quality audio, and more!</p>
                            </div>
                            <button class="action-btn primary pulse"
                                onclick="window.open('https://patreon.com/tymee', '_blank')">Get Premium</button>
                        </div>

                        <div class="settings-group">
                            <h3>Active Premium Features</h3>
                            <div class="feature-list">
                                <div class="feature-item active">
                                    <span>‚úÖ</span> Unlimited Queue
                                </div>
                                <div class="feature-item active">
                                    <span>‚úÖ</span> Higher Quality
                                </div>
                                <div class="feature-item inactive" id="feat-247-status">
                                    <span>‚ùå</span> 24/7 Mode
                                </div>
                                <div class="feature-item inactive" id="feat-autoplay-status">
                                    <span>‚ùå</span> Smart Autoplay
                                </div>
                            </div>
                        </div>
                    </div>
                    <button id="saveSettingsBtn" class="action-btn primary large">
                        üíæ Save All Settings
                    </button>
                </div>
            </div>
            <!-- Emoji Management Page -->
            <div id="emojisPage" class="page hidden">
                <div class="emojis-section">
                    <div class="emoji-management-header">
                        <h3>üòÄ Emoji Management</h3>
                    </div>
                    <!-- Server Emoji Sync Panel -->
                    <div class="emoji-sync-panel">
                        <div class="sync-header">
                            <h4>üîó Server Emoji Sync</h4>
                            <button id="syncPreviewBtn" class="action-btn">
                                üëÄ Preview Sync
                            </button>
                        </div>
                        <p class="sync-description">
                            Auto-detect and match server emojis with bot functions based on
                            name similarity.
                        </p>
                        <div class="sync-actions" style="display: flex; gap: 10px; margin-top: 10px;">
                            <button id="syncServerBtn" class="action-btn secondary">
                                üîÑ Sync Server Emojis
                            </button>
                            <button id="autoMatchBtn" class="action-btn primary">
                                ‚ö° Auto-Match Emojis
                            </button>
                        </div>
                    </div>
                    <!-- Live Discord Preview -->
                    <div class="live-preview-panel section-card">
                        <div class="panel-header">
                            <h4>üì± Live Discord Preview</h4>
                            <span class="badge small">Real-time</span>
                        </div>
                        <div class="discord-embed-preview">
                            <div class="discord-embed">
                                <div class="discord-embed-content">
                                    <div class="discord-author">
                                        <img src="https://i.imgur.com/JDkkTEx.png" class="bot-avatar" alt="Bot">
                                        <span class="bot-name">TymeeMusic</span>
                                        <span class="bot-tag">BOT</span>
                                    </div>
                                    <div class="discord-title">Now Playing</div>
                                    <div class="discord-description">
                                        <span id="preview-status-emoji">üéµ</span> **Never Gonna Give You Up**
                                        <br>
                                        <small>Rick Astley</small>
                                    </div>
                                    <div class="discord-footer">
                                        <div class="player-controls-preview">
                                            <span id="preview-prev-btn" class="preview-btn">‚èÆÔ∏è</span>
                                            <span id="preview-play-btn" class="preview-btn">‚è∏Ô∏è</span>
                                            <span id="preview-skip-btn" class="preview-btn">‚è≠Ô∏è</span>
                                            <span id="preview-stop-btn" class="preview-btn">‚èπÔ∏è</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Server Emojis Picker -->
                    <div class="server-emojis-panel">
                        <div class="server-emojis-header">
                            <h4>üé® Server Emojis</h4>
                            <div class="server-emoji-filters">
                                <button class="filter-btn active" data-filter="all">
                                    All
                                </button>
                                <button class="filter-btn" data-filter="animated">
                                    Animated
                                </button>
                                <button class="filter-btn" data-filter="static">
                                    Static
                                </button>
                                <input type="text" id="emojiSearch" class="emoji-search"
                                    placeholder="Search emojis..." />
                            </div>
                        </div>
                        <div id="serverEmojisGrid" class="server-emojis-grid">
                            <p class="loading">Loading server emojis...</p>
                        </div>
                    </div>
                    <!-- Emoji Mappings List -->
                    <div class="emoji-mappings-panel">
                        <h4>üìã Emoji Mappings</h4>
                        <div class="emoji-filters">
                            <select id="emojiCategoryFilter" class="category-select">
                                <option value="all">All Categories</option>
                                <option value="player_controls">Player Controls</option>
                                <option value="voice_status">Voice Channel Status</option>
                                <option value="now_playing">Now Playing</option>
                                <option value="embeds">Embeds</option>
                                <option value="actions">Actions</option>
                                <option value="filters">Filters</option>
                                <option value="custom">Custom</option>
                            </select>
                            <input type="text" id="mappingSearch" class="mapping-search"
                                placeholder="Search mappings..." />
                        </div>
                        <div id="emojiMappings" class="emoji-mappings-list">
                            <p class="loading-emojis">Loading emoji mappings...</p>
                        </div>
                    </div>
                    <!-- Add New Mapping -->
                    <div class="add-mapping-panel">
                        <h4>‚ûï Add New Mapping</h4>
                        <div class="add-mapping-form">
                            <div class="form-group">
                                <label>Bot Function Name:</label>
                                <input type="text" id="newBotName" placeholder="e.g., play, sp, music" />
                            </div>
                            <div class="form-group">
                                <label>Emoji:</label>
                                <div class="emoji-input-group">
                                    <input type="text" id="newEmoji" placeholder="Paste emoji or select from server" />
                                    <button id="selectFromServerBtn" class="action-btn small">
                                        üìã Select
                                    </button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Category:</label>
                                <select id="newEmojiCategory">
                                    <option value="player_controls">Player Controls</option>
                                    <option value="voice_status">Voice Channel Status</option>
                                    <option value="now_playing">Now Playing</option>
                                    <option value="embeds">Embeds</option>
                                    <option value="actions">Actions</option>
                                    <option value="filters">Filters</option>
                                    <option value="custom">Custom</option>
                                </select>
                            </div>
                            <button id="addMappingBtn" class="action-btn primary">
                                ‚úÖ Add Mapping
                            </button>
                        </div>
                    </div>
                    <!-- Actions -->
                    <div class="emoji-actions">
                        <button id="resetEmojisBtn" class="action-btn danger">
                            üîÑ Reset All to Defaults
                        </button>
                    </div>
                </div>
            </div>
            <!-- Server Emoji Picker Modal -->
            <div id="emojiPickerModal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4>Select Server Emoji</h4>
                        <button class="modal-close" onclick="dashboard.closeEmojiPicker()">
                            &times;
                        </button>
                    </div>
                    <div class="modal-body">
                        <div id="modalEmojiGrid" class="server-emojis-grid"></div>
                    </div>
                </div>
            </div>
            <!-- Sync Preview Modal -->
            <div id="syncPreviewModal" class="modal hidden">
                <div class="modal-content large">
                    <div class="modal-header">
                        <h4>üîÑ Sync Preview</h4>
                        <button class="modal-close" onclick="dashboard.closeSyncPreview()">
                            &times;
                        </button>
                    </div>
                    <div class="modal-body">
                        <p class="sync-info">
                            The following emojis will be automatically mapped:
                        </p>
                        <div id="syncPreviewList" class="sync-preview-list"></div>
                    </div>
                    <div class="modal-footer">
                        <button onclick="dashboard.closeSyncPreview()" class="action-btn">
                            Cancel
                        </button>
                        <button onclick="dashboard.applySync()" class="action-btn primary">
                            Apply Sync
                        </button>
                    </div>
                </div>
            </div>
            <!-- Stats Page -->
            <div id="statsPage" class="page hidden">
                <div class="stats-section">
                    <h3>üìä Statistics</h3>
                    <!-- Server Stats -->
                    <div class="stats-header">
                        <h4>Server Statistics</h4>
                        <button onclick="dashboard.loadStats()" class="action-btn small">
                            üîÑ Refresh
                        </button>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">üéµ</div>
                            <h4>Total Plays</h4>
                            <span id="totalPlays" class="stat-value">0</span>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üë•</div>
                            <h4>Unique Users</h4>
                            <span id="uniqueUsers" class="stat-value">0</span>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üéß</div>
                            <h4>Top Source</h4>
                            <span id="topGenre" class="stat-value">N/A</span>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">‚è±Ô∏è</div>
                            <h4>Bot Uptime</h4>
                            <span id="botUptime" class="stat-value">0h</span>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üìÄ</div>
                            <h4>Tracks Played</h4>
                            <span id="historyCount" class="stat-value">0</span>
                        </div>
                    </div>
                    <!-- Top Songs -->
                    <div class="stats-section-detailed">
                        <h4>üèÜ Top Played Songs</h4>
                        <div id="topSongsList" class="top-songs-list">
                            <p class="loading-stats">Loading statistics...</p>
                        </div>
                    </div>
                    <!-- Source Distribution -->
                    <div class="stats-section-detailed">
                        <h4>üì° Music Sources</h4>
                        <div id="sourceDistribution" class="source-distribution">
                            <p class="loading-stats">Loading source data...</p>
                        </div>
                    </div>
                    <!-- Global Bot Stats (if admin) -->
                    <div id="globalStatsSection" class="stats-section-detailed hidden">
                        <h4>üåê Global Bot Statistics</h4>
                        <div class="stats-grid">
                            <div class="stat-card small">
                                <h4>Total Servers</h4>
                                <span id="globalGuilds" class="stat-value">0</span>
                            </div>
                            <div class="stat-card small">
                                <h4>Active Players</h4>
                                <span id="globalPlayers" class="stat-value">0</span>
                            </div>
                            <div class="stat-card small">
                                <h4>Total Plays</h4>
                                <span id="globalPlays" class="stat-value">0</span>
                            </div>
                            <div class="stat-card small">
                                <h4>Unique Users</h4>
                                <span id="globalUsers" class="stat-value">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <!-- Global Modals -->
    <div id="lyricsModal" class="modal hidden">
        <div class="modal-content lyrics-modal-content">
            <div class="modal-header">
                <h3>üìù Lyrics</h3>
                <button class="modal-close" onclick="dashboard.closeModal('lyricsModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="lyrics-header-actions">
                    <div id="lyricsTitle" class="lyrics-track-title">Loading...</div>
                    <div class="lyrics-translate-controls">
                        <select id="lyricsLangSelect" class="lang-select">
                            <option value="en">English</option>
                            <option value="es">Spanish</option>
                            <option value="fr">French</option>
                            <option value="de">German</option>
                            <option value="ko">Korean</option>
                            <option value="ja">Japanese</option>
                            <option value="vi">Vietnamese</option>
                            <option value="id">Indonesian</option>
                            <option value="th">Thai</option>
                            <option value="zh">Chinese</option>
                        </select>
                        <button id="translateLyricsBtn" class="action-btn small secondary"
                            onclick="dashboard.translateLyrics()">
                            üåê Translate
                        </button>
                    </div>
                </div>
                <div id="lyricsContent" class="lyrics-body">
                    <!-- Lyrics will be injected here -->
                </div>
            </div>
        </div>
    </div>
    <!-- Permission Request Modal (for session owners) -->
    <div id="permissionRequestModal" class="permission-modal hidden">
        <div class="permission-modal-content">
            <div class="permission-header">
                <span class="permission-icon">üîî</span>
                <h4>Permission Request</h4>
            </div>
            <div class="permission-body">
                <div class="requester-info">
                    <img id="permRequesterAvatar" class="requester-avatar" src="" alt="">
                    <div class="requester-details">
                        <span id="permRequesterName" class="requester-name"></span>
                        <span class="permission-action">wants to <strong id="permAction">control the
                                player</strong></span>
                    </div>
                </div>
                <p class="permission-message">Allow this user to control the music player?</p>
            </div>
            <div class="permission-actions">
                <button id="denyPermissionBtn" class="action-btn danger">
                    ‚ùå Deny
                </button>
                <button id="approvePermissionBtn" class="action-btn primary">
                    ‚úÖ Approve
                </button>
            </div>
        </div>
    </div>
    <!-- Permission Denied Notification (for requesters) -->
    <div id="permissionDeniedNotification" class="permission-notification hidden">
        <div class="notification-content denied">
            <span class="notification-icon">üö´</span>
            <span class="notification-text">Permission denied by session owner</span>
        </div>
    </div>
    <!-- Permission Approved Notification -->
    <div id="permissionApprovedNotification" class="permission-notification hidden">
        <div class="notification-content approved">
            <span class="notification-icon">‚úÖ</span>
            <span class="notification-text">Permission granted! You can now control the player.</span>
        </div>
    </div>
    <!-- Session Owner Indicator -->
    <div id="sessionOwnerBadge" class="session-owner-badge hidden">
        <span class="badge-icon">üëë</span>
        <span class="badge-text">Session Owner</span>
    </div>
    <!-- Audio for notification sound -->
    <audio id="notificationSound" preload="auto">
        <source
            src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2teleEEwhae3qsO9k0E5b5Guqam1u4NJOX2PmKCcobRzPkF7i5OZhIh+YEFEa36JkYaBeWNBRWt+iZGGgXljQUVrfomRhoF5Y0FFa36JkYaBeWNBRWt+iZGGgXljQUVrfomRhoF5Y0FFa36JkYaBeWNB"
            type="audio/wav">
    </audio>
    <!-- Scripts -->
    <script src="app.js"></script>
</body>

</html>